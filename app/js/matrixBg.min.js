var canvas,ctx,columns,mainInterval,whiteFontInterval,soundKeypress,soundModem,MatrixMainWrapper,introParam;var letters="abcdefghijklmnopqrstuwxyz1234567890";var fontSize=25;var keypressInterval=200;var canvasLoaded=false;var timeoutParam=500;var letterPos=[];var prev=[];var timeouts=[];var bodyLoaded=false;window.addEventListener("resize",onCanvasResize);window.onload=function(){MatrixMainWrapper=document.getElementsByClassName("Matrix-mainWrapper")[0];MatrixMainWrapper.style.display="none";var e=document.createElement("style");e.appendChild(document.createTextNode('@font-face {font-family: "matrixFont";src: url("fonts/matrix.ttf");}'));e.appendChild(document.createTextNode(".Matrix-mainWrapper {position: relative;}"));document.head.appendChild(e);var d=document.createElement("div");d.id="MatrixBgHolder";d.style.position="absolute";d.style.top="0";d.style.right="0";d.style.bottom="0";d.style.left="0";document.body.style.background="#000";var b=document.createElement("canvas");b.id="MatrixCanvas";var c=document.createElement("audio");c.id="MatrixKeypress";c.src="audio/keypress.mp3";c.setAttribute("preload","auto");var a=document.createElement("audio");a.id="MatrixModem";a.src="audio/modem.mp3";a.setAttribute("preload","auto");d.appendChild(b);d.appendChild(c);d.appendChild(a);document.body.insertBefore(d,document.body.firstChild);document.getElementById("rot").innerHTML="please, push the rotate button or Access key 'r' ! ( <a href='https://en.wikipedia.org/wiki/Access_key' title='Access key on Wikipedia' target='_blank'>hyperlink</a> )";if(introParam=="yes"){cursorMatrixBG(introParam)}else{cursorMatrixBG()}getDweetFor()};function MatrixInit(a){introParam=a}function setupMatrixBG(){if(!canvasLoaded){canvas=document.getElementById("MatrixCanvas");ctx=canvas.getContext("2d");letters=letters.split("");canvasLoaded=true}canvas.height=window.innerHeight;canvas.width=window.innerWidth;columns=canvas.width/fontSize;for(var a=0;a<columns;a++){letterPos[a]=window.innerHeight}}function cursorMatrixBG(c){setupMatrixBG();var b=c||"no";if(b=="yes"){var a=new Array("$ root login:","_","rc2c","$ root password:","***","$ calling, please wait..."," OK","$ entering the matrix, welcome.");soundKeypress=document.getElementById("MatrixKeypress");soundModem=document.getElementById("MatrixModem");ctx.font=fontSize+"px arial";ctx.fillStyle="#0F0";ctx.font="20px sans-serif";ctx.fillText(a[0],20,fontSize);ctx.fillText(a[1],130,fontSize);timeouts.push(setTimeout(function(){ctx.clearRect(130,fontSize,canvas.width,fontSize)},timeoutParam));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutParam*2));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutParam*3));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutParam*4));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutParam*5));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutParam*6));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutParam*7));timeouts.push(setTimeout(function(){typeOut(a[2],130,fontSize,0,0);soundKeypress.play()},timeoutParam*8));timeouts.push(setTimeout(function(){ctx.fillText(a[3],20,fontSize*2)},timeoutParam*10));timeouts.push(setTimeout(function(){ctx.fillText(a[1],175,fontSize*2)},timeoutParam*11));timeouts.push(setTimeout(function(){ctx.clearRect(170,fontSize*2,canvas.width,fontSize)},timeoutParam*12));timeouts.push(setTimeout(function(){typeOut(a[4],175,fontSize*2,0,0);soundKeypress.play()},timeoutParam*15));timeouts.push(setTimeout(function(){ctx.fillText(a[5],20,fontSize*3)},timeoutParam*17));timeouts.push(setTimeout(function(){soundModem.play()},timeoutParam*18));timeouts.push(setTimeout(function(){ctx.fillText(a[6],230,fontSize*3)},timeoutParam*33));timeouts.push(setTimeout(function(){ctx.clearRect(0,0,canvas.width,canvas.height)},timeoutParam*35));timeouts.push(setTimeout(function(){mainInterval=setInterval(drawMatrixBG,80);fadeIn(MatrixMainWrapper);bodyLoaded=true},(timeoutParam*35)+100))}else{mainInterval=setInterval(drawMatrixBG,80);if(!bodyLoaded){fadeIn(MatrixMainWrapper);bodyLoaded=true}}}function drawMatrixBG(){prev=[];ctx.fillStyle="rgba(0, 0, 0, 0.05)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#fff";ctx.font=fontSize+"px matrixFont";for(var a=0;a<letterPos.length;a++){var b=letters[Math.floor(Math.random()*letters.length)];prev.push(b);ctx.fillText(b,a*fontSize,letterPos[a]*fontSize);if(letterPos[a]*fontSize>canvas.height&&Math.random()>0.945){letterPos[a]=0}letterPos[a]++}whiteFontInterval=setTimeout(function(){ctx.fillStyle="rgba(0, 0, 0, 0.05)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#0F0";ctx.font=fontSize+"px matrixFont";for(var c=0;c<letterPos.length;c++){ctx.fillText(prev[c],c*fontSize,(letterPos[c]-1)*fontSize)}},190)}function getDweetFor(){document.getElementById("s").innerHTML="";var a=document.getElementById("thing").value;document.getElementById("title").innerHTML=a;dweetio.get_all_dweets_for(a,function(e,d){d.reverse();var c="";for(theDweet in d){var b=d[theDweet];findAndReplace(b,"--------------","\r");findAndReplace(b,"utilisez ROT13 après assemblage","\r");findAndReplace(b,"Bon choix pour la pilule. Vous y êtes presque.","\r");c+=b.content.message}var f=c.replace(/undefined/gi,"");document.getElementById("s").innerHTML=f;document.getElementById("btn").style.display="block"})}function handleRotate(){var e=+document.getElementById("turn").value;var d=null;d=document.getElementById("s").value;var a=rot(d,e);var c=a.replace(/(\r\n|\n|\r)/gm,"<br>");var b=c.replace(/Qngr qr yn fédhrapr/gi,"Date de la séquence");document.getElementById("rot").innerHTML=b}function typeOut(h,d,b,f,g){var c=d||0;var a=b||0;var f=f||32;g=g||10;var e=0;$_inter=setInterval(function(){var i=ctx.measureText(h.charAt(e)).width;if(c+i>=canvas.width-g){c=d;a+=f}ctx.fillText(h.charAt(e),c,a);e++;c+=i;if(e===h.length){clearInterval($_inter)}},keypressInterval)}function fadeIn(b){b.style.opacity=0;b.style.display="block";(function a(){var c=parseFloat(b.style.opacity);if(!((c+=0.1)>1)){b.style.opacity=c;requestAnimationFrame(a)}})()}function onCanvasResize(){if(soundKeypress){soundKeypress.pause();soundKeypress.currentTime=0}if(soundModem){soundModem.pause();soundModem.currentTime=0}clearInterval(mainInterval);clearInterval(whiteFontInterval);for(var a=0;a<timeouts.length;a++){clearTimeout(timeouts[a])}ctx.clearRect(0,0,canvas.width,canvas.height);cursorMatrixBG();if(!bodyLoaded){fadeIn(MatrixMainWrapper);bodyLoaded=true}}function findAndReplace(b,d,c){for(var a in b){if(typeof b[a]==typeof{}){findAndReplace(b[a],d,c)}if(b[a]==d){b.message=c}}}function rot(b,a){return b.replace(/[a-zA-Z]/g,function(d){return String.fromCharCode((d<="Z"?90:122)>=(d=d.charCodeAt(0)+a)?d:d-26)})}function reloadDweetFor(){document.getElementById("rot").innerHTML="";document.getElementById("rot").innerHTML="please, push the rotate button or Access key 'r' ! ( <a href='https://en.wikipedia.org/wiki/Access_key' title='Access key on Wikipedia' target='_blank'>hyperlink</a> )";getDweetFor()};