var canvas,ctx,columns,mainInt,whiteFontInt,sdKeypress,sdModem,matMainWrapper,intParam;var letters="abcdefghijklmnopqrstuwxyz1234567890";var fontSize=25;var kpressInt=200;var canvasLoad=false;var timeoutPar=500;var lettersPos=[];var prev=[];var timeouts=[];var bodyLoad=false;window.addEventListener("resize",onCanvasResize);window.onload=function(){if(intParam=="write"||intParam=="read"){var a="../"}else{var a=""}matMainWrapper=document.getElementsByClassName("Mat-mainWrapper")[0];matMainWrapper.style.display="none";var f=document.createElement("style");f.appendChild(document.createTextNode('@font-face {font-family: "matrixFont";src: url("'+a+'fonts/matrixFont.ttf");}'));f.appendChild(document.createTextNode(".Mat-mainWrapper {position: relative;}"));document.head.appendChild(f);var c=document.createElement("div");c.id="MatHolder";c.style.position="absolute";c.style.top="0";c.style.right="0";c.style.bottom="0";c.style.left="0";document.body.style.background="#000";var b=document.createElement("canvas");b.id="MatCanvas";var e=document.createElement("audio");e.id="MatKeypress";e.src=a+"audio/keypressSound.mp3";e.setAttribute("preload","auto");var d=document.createElement("audio");d.id="MatModem";d.src=a+"audio/modemSound.mp3";d.setAttribute("preload","auto");c.appendChild(b);c.appendChild(e);c.appendChild(d);document.body.insertBefore(c,document.body.firstChild);if(intParam=="yes"){cursorMatrixBG(intParam);reloadDweetFor()}else{if(intParam=="write"){cursorMatrixBG();getUrlValue();reloadDweetSend()}else{if(intParam=="read"){cursorMatrixBG();getUrlValue();reloadDweetFor()}else{cursorMatrixBG();getUrlValue();reloadDweetFor()}}}changesThing()};function MatInit(a){intParam=a}function setupMatBG(){if(!canvasLoad){canvas=document.getElementById("MatCanvas");ctx=canvas.getContext("2d");letters=letters.split("");canvasLoad=true}canvas.height=window.innerHeight;canvas.width=window.innerWidth;columns=canvas.width/fontSize;for(var a=0;a<columns;a++){lettersPos[a]=window.innerHeight}}function cursorMatrixBG(c){setupMatBG();var b=c||"no";if(b=="yes"){var a=new Array("$ root login:","_","neo","$ root password:","***","$ calling, please wait..."," OK","$ entering the matrix, welcome.");sdKeypress=document.getElementById("MatKeypress");sdModem=document.getElementById("MatModem");ctx.font=fontSize+"px arial";ctx.fillStyle="#0F0";ctx.font="20px sans-serif";ctx.fillText(a[0],20,fontSize);ctx.fillText(a[1],130,fontSize);timeouts.push(setTimeout(function(){ctx.clearRect(130,fontSize,canvas.width,fontSize)},timeoutPar));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutPar*2));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutPar*3));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutPar*4));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutPar*5));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutPar*6));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutPar*7));timeouts.push(setTimeout(function(){typeOut(a[2],130,fontSize,0,0);sdKeypress.play()},timeoutPar*8));timeouts.push(setTimeout(function(){ctx.fillText(a[3],20,fontSize*2)},timeoutPar*10));timeouts.push(setTimeout(function(){ctx.fillText(a[1],175,fontSize*2)},timeoutPar*11));timeouts.push(setTimeout(function(){ctx.clearRect(170,fontSize*2,canvas.width,fontSize)},timeoutPar*12));timeouts.push(setTimeout(function(){typeOut(a[4],175,fontSize*2,0,0);sdKeypress.play()},timeoutPar*15));timeouts.push(setTimeout(function(){ctx.fillText(a[5],20,fontSize*3)},timeoutPar*17));timeouts.push(setTimeout(function(){sdModem.play()},timeoutPar*18));timeouts.push(setTimeout(function(){ctx.fillText(a[6],230,fontSize*3)},timeoutPar*33));timeouts.push(setTimeout(function(){ctx.clearRect(0,0,canvas.width,canvas.height)},timeoutPar*35));timeouts.push(setTimeout(function(){mainInt=setInterval(drawMatrixBG,80);fadeIn(matMainWrapper);bodyLoad=true},(timeoutPar*35)+100))}else{mainInt=setInterval(drawMatrixBG,80);if(!bodyLoad){fadeIn(matMainWrapper);bodyLoad=true}}}function drawMatrixBG(){prev=[];ctx.fillStyle="rgba(0, 0, 0, 0.05)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#fff";ctx.font=fontSize+"px matrixFont";for(var a=0;a<lettersPos.length;a++){var b=letters[Math.floor(Math.random()*letters.length)];prev.push(b);ctx.fillText(b,a*fontSize,lettersPos[a]*fontSize);if(lettersPos[a]*fontSize>canvas.height&&Math.random()>0.945){lettersPos[a]=0}lettersPos[a]++}whiteFontInt=setTimeout(function(){ctx.fillStyle="rgba(0, 0, 0, 0.05)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#0F0";ctx.font=fontSize+"px matrixFont";for(var c=0;c<lettersPos.length;c++){ctx.fillText(prev[c],c*fontSize,(lettersPos[c]-1)*fontSize)}},190)}function getDweetFor(){document.getElementById("s").innerHTML="";var a=document.getElementById("thing").value;document.getElementById("title").innerHTML=a;dweetio.get_all_dweets_for(a,function(e,d){d.reverse();var c="";for(theDweet in d){var b=d[theDweet];findAndReplace(b,"--------------","\r");findAndReplace(b,"utilisez ROT13 après assemblage","\r");findAndReplace(b,"Bon choix pour la pilule. Vous y êtes presque.","\r");c+=b.content.message}var f=c.replace(/undefined/gi,"");document.getElementById("s").innerHTML=f;document.getElementById("btnR").style.display="block"})}function handleRotate(){var e=+document.getElementById("turn").value;var d=null;d=document.getElementById("s").value;var a=rot(d,e);var c=a.replace(/(\r\n|\n|\r)/gm,"<br>");var b=c.replace(/Qngr qr yn fédhrapr/gi,"Date de la séquence");document.getElementById("rotR").innerHTML=b}function dweetMessage(){today=new Date();var o=today.format("dd-mm-yyyy HH:MM");document.getElementById("rotS").innerHTML="";showDweets();document.getElementById("btnS").style.display="none";document.getElementById("sendProgress").style.display="block";var d=document.getElementById("thing").value;var e=+document.getElementById("turn").value;var p=null;p=document.getElementById("s").value;p=p.replace(/(\r\n|\n|\r)/gm,"");var g=rot(p,e);var l=[];l.push("--------------");l.push("Date de la séquence "+o);l.push("--------------");l.push("utilisez ROT"+e+" après assemblage");var k=g.split("");k.push("--------------");k.push("Bon choix pour la pilule. Vous y êtes presque.");var f=l.concat(k);var n=document.getElementById("sendBar");var b=0;var h=f.length*10;var a=setInterval(c,h);function c(){if(b==100){clearInterval(a)}else{b++;n.style.width=b+"%"}}for(var j=0;j<f.length;j++){setTimeout(function(i){return function(){dweetio.dweet_for(d,{message:f[i]},function(q,m){});if(i+1==f.length){document.getElementById("sendProgress").style.display="none";document.getElementById("btnS").style.display="block";dweetio.stop_listening_for(d);reloadDweetSend()}}}(j),1000*j)}}function showDweets(){var a=document.getElementById("thing").value;document.getElementById("title").innerHTML=a;dweetio.listen_for(a,function(b){document.getElementById("rotS").innerHTML+=b.content.message})}function typeOut(h,d,b,f,g){var c=d||0;var a=b||0;var f=f||32;g=g||10;var e=0;$_inter=setInterval(function(){var i=ctx.measureText(h.charAt(e)).width;if(c+i>=canvas.width-g){c=d;a+=f}ctx.fillText(h.charAt(e),c,a);e++;c+=i;if(e===h.length){clearInterval($_inter)}},kpressInt)}function fadeIn(b){b.style.opacity=0;b.style.display="block";(function a(){var c=parseFloat(b.style.opacity);if(!((c+=0.1)>1)){b.style.opacity=c;requestAnimationFrame(a)}})()}function onCanvasResize(){if(sdKeypress){sdKeypress.pause();sdKeypress.currentTime=0}if(sdModem){sdModem.pause();sdModem.currentTime=0}clearInterval(mainInt);clearInterval(whiteFontInt);for(var a=0;a<timeouts.length;a++){clearTimeout(timeouts[a])}ctx.clearRect(0,0,canvas.width,canvas.height);cursorMatrixBG();if(!bodyLoad){fadeIn(matMainWrapper);bodyLoad=true}}function getUrlVars(){var d=[],c;var a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var b=0;b<a.length;b++){c=a[b].split("=");d.push(c[0]);d[c[0]]=c[1]}return d}function getUrlValue(){getUrlVars();var c=getUrlVars()["t"];if(c=="undefined"){var b="neo";var a="13";document.getElementById("thing").value=b;document.getElementById("turn").value=a}else{var b=getUrlVars()["t"];var a=getUrlVars()["r"];document.getElementById("thing").value=b;document.getElementById("turn").value=a}}function findAndReplace(b,d,c){for(var a in b){if(typeof b[a]==typeof{}){findAndReplace(b[a],d,c)}if(b[a]==d){b.message=c}}}function rot(b,a){return b.replace(/[a-zA-Z]/g,function(d){return String.fromCharCode((d<="Z"?90:122)>=(d=d.charCodeAt(0)+a)?d:d-26)})}function addUrlParam(b,c,d){var e=c+"="+d;var a=b.replace(new RegExp("(&|\\?)"+c+"=[^&|#]*"),"$1"+e);if(a===b){a=(b.indexOf("?")!=-1?b.split("?")[0]+"?"+e+"&"+b.split("?")[1]:(b.indexOf("#")!=-1?b.split("#")[0]+"?"+e+"#"+b.split("#")[1]:b+"?"+e))}return a}function changesThing(){var a=document.querySelector("#thing");var b=document.querySelector("#title");a.addEventListener("thing",function(){b.textContent=a.value;var c=a.value;if(intParam=="yes"||intParam=="read"){reloadDweetFor()}else{if(intParam=="write"){reloadDweetSend()}else{reloadDweetFor()}}})}function reloadDweetFor(){var a="<br>hello, concerning readDweet<br>push the rotate button or Access key 'r'<br>push the write button or Access key 'e'<br>push the reload button after modify thing or Access key 'd'";var e="<br>use Access key ( <a href='https://en.wikipedia.org/wiki/Access_key' title='Access key on Wikipedia' target='_blank'>hyperlink</a> )";var d=document.getElementById("thing").value;var f=+document.getElementById("turn").value;document.getElementById("title").innerHTML=d;document.getElementById("rotR").innerHTML=null;document.getElementById("rotR").innerHTML=a+e;if(intParam=="yes"){var c=""}else{var c="../"}var b="location.href='"+c+"write/?r="+f+"&p=1'";link.setAttribute("onclick",addUrlParam(b,"t",d));getDweetFor()}function reloadDweetSend(){var f="<br>hello, concerning writeDweet<br>push the send button or Access key 's'<br>push the read button or Access key 'e'<br>push the reload button after modify thing or Access key 'd'";var d="<br>use Access key ( <a href='https://en.wikipedia.org/wiki/Access_key' title='Access key on Wikipedia' target='_blank'>hyperlink</a> )";var c=document.getElementById("thing").value;var e=+document.getElementById("turn").value;document.getElementById("title").innerHTML=c;document.getElementById("rotS").innerHTML=null;document.getElementById("rotS").innerHTML=f+d;if(intParam=="yes"){var b=""}else{var b="../"}var a="location.href='"+b+"read/?r="+e+"&p=1'";link.setAttribute("onclick",addUrlParam(a,"t",c));document.getElementById("sendProgress").style.display="none";document.getElementById("btnS").style.display="block"};