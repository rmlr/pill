var canvas,ctx,columns,mainInterval,whiteFontInterval,soundKeypress,soundModem,MatrixMainWrapper,introParam;var letters="abcdefghijklmnopqrstuwxyz1234567890";var fontSize=25;var keypressInterval=200;var canvasLoaded=false;var timeoutParam=500;var letterPos=[];var prev=[];var timeouts=[];var bodyLoaded=false;window.addEventListener("resize",onCanvasResize);window.onload=function(){if(introParam=="write"||introParam=="read"){var a="../"}else{var a=""}MatrixMainWrapper=document.getElementsByClassName("Matrix-mainWrapper")[0];MatrixMainWrapper.style.display="none";var f=document.createElement("style");f.appendChild(document.createTextNode('@font-face {font-family: "matrixFont";src: url("'+a+'fonts/matrix.ttf");}'));f.appendChild(document.createTextNode(".Matrix-mainWrapper {position: relative;}"));document.head.appendChild(f);var e=document.createElement("div");e.id="MatrixBgHolder";e.style.position="absolute";e.style.top="0";e.style.right="0";e.style.bottom="0";e.style.left="0";document.body.style.background="#000";var c=document.createElement("canvas");c.id="MatrixCanvas";var d=document.createElement("audio");d.id="MatrixKeypress";d.src=a+"audio/keypress.mp3";d.setAttribute("preload","auto");var b=document.createElement("audio");b.id="MatrixModem";b.src=a+"audio/modem.mp3";b.setAttribute("preload","auto");e.appendChild(c);e.appendChild(d);e.appendChild(b);document.body.insertBefore(e,document.body.firstChild);if(introParam=="yes"){cursorMatrixBG(introParam);reloadDweetFor()}else{if(introParam=="write"){cursorMatrixBG();getUrlValue();reloadDweetSend()}else{if(introParam=="read"){cursorMatrixBG();getUrlValue();reloadDweetFor()}else{cursorMatrixBG();getUrlValue();reloadDweetFor()}}}};function MatrixInit(a){introParam=a}function setupMatrixBG(){if(!canvasLoaded){canvas=document.getElementById("MatrixCanvas");ctx=canvas.getContext("2d");letters=letters.split("");canvasLoaded=true}canvas.height=window.innerHeight;canvas.width=window.innerWidth;columns=canvas.width/fontSize;for(var a=0;a<columns;a++){letterPos[a]=window.innerHeight}}function cursorMatrixBG(c){setupMatrixBG();var b=c||"no";if(b=="yes"){var a=new Array("$ root login:","_","neo","$ root password:","***","$ calling, please wait..."," OK","$ entering the matrix, welcome.");soundKeypress=document.getElementById("MatrixKeypress");soundModem=document.getElementById("MatrixModem");ctx.font=fontSize+"px arial";ctx.fillStyle="#0F0";ctx.font="20px sans-serif";ctx.fillText(a[0],20,fontSize);ctx.fillText(a[1],130,fontSize);timeouts.push(setTimeout(function(){ctx.clearRect(130,fontSize,canvas.width,fontSize)},timeoutParam));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutParam*2));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutParam*3));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutParam*4));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutParam*5));timeouts.push(setTimeout(function(){ctx.fillText(a[1],130,fontSize)},timeoutParam*6));timeouts.push(setTimeout(function(){ctx.clearRect(125,fontSize,canvas.width,fontSize)},timeoutParam*7));timeouts.push(setTimeout(function(){typeOut(a[2],130,fontSize,0,0);soundKeypress.play()},timeoutParam*8));timeouts.push(setTimeout(function(){ctx.fillText(a[3],20,fontSize*2)},timeoutParam*10));timeouts.push(setTimeout(function(){ctx.fillText(a[1],175,fontSize*2)},timeoutParam*11));timeouts.push(setTimeout(function(){ctx.clearRect(170,fontSize*2,canvas.width,fontSize)},timeoutParam*12));timeouts.push(setTimeout(function(){typeOut(a[4],175,fontSize*2,0,0);soundKeypress.play()},timeoutParam*15));timeouts.push(setTimeout(function(){ctx.fillText(a[5],20,fontSize*3)},timeoutParam*17));timeouts.push(setTimeout(function(){soundModem.play()},timeoutParam*18));timeouts.push(setTimeout(function(){ctx.fillText(a[6],230,fontSize*3)},timeoutParam*33));timeouts.push(setTimeout(function(){ctx.clearRect(0,0,canvas.width,canvas.height)},timeoutParam*35));timeouts.push(setTimeout(function(){mainInterval=setInterval(drawMatrixBG,80);fadeIn(MatrixMainWrapper);bodyLoaded=true},(timeoutParam*35)+100))}else{mainInterval=setInterval(drawMatrixBG,80);if(!bodyLoaded){fadeIn(MatrixMainWrapper);bodyLoaded=true}}}function drawMatrixBG(){prev=[];ctx.fillStyle="rgba(0, 0, 0, 0.05)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#fff";ctx.font=fontSize+"px matrixFont";for(var a=0;a<letterPos.length;a++){var b=letters[Math.floor(Math.random()*letters.length)];prev.push(b);ctx.fillText(b,a*fontSize,letterPos[a]*fontSize);if(letterPos[a]*fontSize>canvas.height&&Math.random()>0.945){letterPos[a]=0}letterPos[a]++}whiteFontInterval=setTimeout(function(){ctx.fillStyle="rgba(0, 0, 0, 0.05)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#0F0";ctx.font=fontSize+"px matrixFont";for(var c=0;c<letterPos.length;c++){ctx.fillText(prev[c],c*fontSize,(letterPos[c]-1)*fontSize)}},190)}function getDweetFor(){document.getElementById("s").innerHTML="";var a=document.getElementById("thing").value;document.getElementById("title").innerHTML=a;dweetio.get_all_dweets_for(a,function(e,d){d.reverse();var c="";for(theDweet in d){var b=d[theDweet];findAndReplace(b,"--------------","\r");findAndReplace(b,"utilisez ROT13 après assemblage","\r");findAndReplace(b,"Bon choix pour la pilule. Vous y êtes presque.","\r");c+=b.content.message}var f=c.replace(/undefined/gi,"");document.getElementById("s").innerHTML=f;document.getElementById("btnR").style.display="block"})}function handleRotate(){var e=+document.getElementById("turn").value;var d=null;d=document.getElementById("s").value;var a=rot(d,e);var c=a.replace(/(\r\n|\n|\r)/gm,"<br>");var b=c.replace(/Qngr qr yn fédhrapr/gi,"Date de la séquence");document.getElementById("rotR").innerHTML=b}function dweetMessage(){document.getElementById("rotS").innerHTML="";showDweets();document.getElementById("btnS").style.display="none";document.getElementById("sendProgress").style.display="block";var d=document.getElementById("thing").value;var e=+document.getElementById("turn").value;var o=null;o=document.getElementById("s").value;o=o.replace(/(\r\n|\n|\r)/gm,"");var g=rot(o,e);var l=["--------------"];l.push("Date de la séquence "+dateString);l.push("--------------");l.push("utilisez ROT"+e+" après assemblage");var k=g.split("");k.push("--------------");k.push("Bon choix pour la pilule. Vous y êtes presque.");var f=l.concat(k);var n=document.getElementById("sendBar");var b=0;var h=f.length*10;var a=setInterval(c,h);function c(){if(b==100){clearInterval(a)}else{b++;n.style.width=b+"%"}}for(var j=0;j<f.length;j++){setTimeout(function(i){return function(){dweetio.dweet_for(d,{message:f[i]},function(p,m){console.log(m.thing);console.log(m.content);console.log(m.created)});if(i+1==f.length){document.getElementById("sendProgress").style.display="none";document.getElementById("btnS").style.display="block"}}}(j),1000*j)}}function showDweets(){var a=document.getElementById("thing").value;document.getElementById("title").innerHTML=a;dweetio.listen_for(a,function(b){console.log(b);document.getElementById("rotS").innerHTML+=b.content.message})}function typeOut(h,d,b,f,g){var c=d||0;var a=b||0;var f=f||32;g=g||10;var e=0;$_inter=setInterval(function(){var i=ctx.measureText(h.charAt(e)).width;if(c+i>=canvas.width-g){c=d;a+=f}ctx.fillText(h.charAt(e),c,a);e++;c+=i;if(e===h.length){clearInterval($_inter)}},keypressInterval)}function fadeIn(b){b.style.opacity=0;b.style.display="block";(function a(){var c=parseFloat(b.style.opacity);if(!((c+=0.1)>1)){b.style.opacity=c;requestAnimationFrame(a)}})()}function onCanvasResize(){if(soundKeypress){soundKeypress.pause();soundKeypress.currentTime=0}if(soundModem){soundModem.pause();soundModem.currentTime=0}clearInterval(mainInterval);clearInterval(whiteFontInterval);for(var a=0;a<timeouts.length;a++){clearTimeout(timeouts[a])}ctx.clearRect(0,0,canvas.width,canvas.height);cursorMatrixBG();if(!bodyLoaded){fadeIn(MatrixMainWrapper);bodyLoaded=true}}function getUrlVars(){var d=[],c;var a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var b=0;b<a.length;b++){c=a[b].split("=");d.push(c[0]);d[c[0]]=c[1]}return d}function getUrlValue(){getUrlVars();var c=getUrlVars()["t"];if(c=="undefined"){var b="neo";var a="13";document.getElementById("thing").value=b;document.getElementById("turn").value=a}else{var b=getUrlVars()["t"];var a=getUrlVars()["r"];document.getElementById("thing").value=b;document.getElementById("turn").value=a}}function findAndReplace(b,d,c){for(var a in b){if(typeof b[a]==typeof{}){findAndReplace(b[a],d,c)}if(b[a]==d){b.message=c}}}function rot(b,a){return b.replace(/[a-zA-Z]/g,function(d){return String.fromCharCode((d<="Z"?90:122)>=(d=d.charCodeAt(0)+a)?d:d-26)})}function addUrlParam(b,c,d){var e=c+"="+d;var a=b.replace(new RegExp("(&|\\?)"+c+"=[^&|#]*"),"$1"+e);if(a===b){a=(b.indexOf("?")!=-1?b.split("?")[0]+"?"+e+"&"+b.split("?")[1]:(b.indexOf("#")!=-1?b.split("#")[0]+"?"+e+"#"+b.split("#")[1]:b+"?"+e))}return a}function reloadDweetFor(){var a="<br>hello, concerning readDweet<br>push the rotate button or Access key 'r'<br>push the write button or Access key 'e'<br>push the reload button after modify thing or Access key 'd'";var e="<br>use Access key ( <a href='https://en.wikipedia.org/wiki/Access_key' title='Access key on Wikipedia' target='_blank'>hyperlink</a> )";var d=document.getElementById("thing").value;var f=+document.getElementById("turn").value;document.getElementById("title").innerHTML=d;document.getElementById("rotR").innerHTML=null;document.getElementById("rotR").innerHTML=a+e;if(introParam=="yes"){var c=""}else{var c="../"}var b="location.href='"+c+"write/?r="+f+"&p=1'";link.setAttribute("onclick",addUrlParam(b,"t",d));getDweetFor()}function reloadDweetSend(){var f="<br>hello, concerning writeDweet<br>push the send button or Access key 's'<br>push the read button or Access key 'e'<br>push the reload button after modify thing or Access key 'd'";var d="<br>use Access key ( <a href='https://en.wikipedia.org/wiki/Access_key' title='Access key on Wikipedia' target='_blank'>hyperlink</a> )";var c=document.getElementById("thing").value;var e=+document.getElementById("turn").value;document.getElementById("title").innerHTML=c;document.getElementById("rotS").innerHTML=null;document.getElementById("rotS").innerHTML=f+d;if(introParam=="yes"){var b=""}else{var b="../"}var a="location.href='"+b+"read/?r="+e+"&p=1'";link.setAttribute("onclick",addUrlParam(a,"t",c));document.getElementById("sendProgress").style.display="none";document.getElementById("btnS").style.display="block"};